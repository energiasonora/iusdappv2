<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>STARK ID</title>
		<meta name="description" content="Some inspiration for search UI effects" />
		<meta name="keywords" content="web design, inspiration, search, ui, effect, javascript, animation" />
		<meta name="author" content="Codrops" />
		<link rel="shortcut icon" href="favicon.ico">
		<link href="https://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet">
		
		<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" /> -->
		<link rel="stylesheet" type="text/css" href="css/starkid.css" />
        <script src="js/sweetalert2.all.min.js"></script>
        <script src="js/qr-code-styling.js"></script>
		<!--[if IE]>
  		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]--><script>document.documentElement.className = 'js';</script>
	</head>
	<body class="demo-1">

    <!-----------------------------
	LOADER 
	--------------------------->
<div class="loaderDiv" id="loader"> <span class="loader"></span> </div>

		<svg class="hidden">
			<defs>

				<!-- 1 -->
				<symbol id="icon-menu" viewBox="0 0 24 24" >
					<title >menu</title>
					<image preserveAspectRatio="none" inkscape:svg-dpi="300" width="17.49" height="19.988571" style="image-rendering:optimizeQuality" xlink:href="data:image/svg+xml;base64,PHN2ZyBpZD0iaWNvbi1tZW51IiB2aWV3Qm94PSIwIDAgNDQ4IDUxMiI+CjxwYXRoIGQ9Ik0wIDk2 QzAgNzguMyAxNC4zIDY0IDMyIDY0SDQxNmMxNy43IDAgMzIgMTQuMyAzMiAzMnMtMTQuMyAzMi0z MiAzMkgzMkMxNC4zIDEyOCAwIDExMy43IDAgOTZ6TTAgMjU2YzAtMTcuNyAxNC4zLTMyIDMyLTMy SDQxNmMxNy43IDAgMzIgMTQuMyAzMiAzMnMtMTQuMyAzMi0zMiAzMkgzMmMtMTcuNyAwLTMyLTE0 LjMtMzItMzJ6TTQ0OCA0MTZjMCAxNy43LTE0LjMgMzItMzIgMzJIMzJjLTE3LjcgMC0zMi0xNC4z LTMyLTMyczE0LjMtMzIgMzItMzJINDE2YzE3LjcgMCAzMiAxNC4zIDMyIDMyeiIvPgo8L3N2Zz4K " id="image120" x="3.2550001" y="2.0057144" />
				  </symbol>				 
				  <!-- 1 -->
				<symbol id="icon-arrow" viewBox="0 0 24 24">
					<title>arrow</title>
					<polygon points="6.3,12.8 20.9,12.8 20.9,11.2 6.3,11.2 10.2,7.2 9,6 3.1,12 9,18 10.2,16.8 "/>
				</symbol>

				<symbol id="icon-drop" viewBox="0 0 24 24">
					<title>drop</title>
					<path d="M12,21c-3.6,0-6.6-3-6.6-6.6C5.4,11,10.8,4,11.4,3.2C11.6,3.1,11.8,3,12,3s0.4,0.1,0.6,0.3c0.6,0.8,6.1,7.8,6.1,11.2C18.6,18.1,15.6,21,12,21zM12,4.8c-1.8,2.4-5.2,7.4-5.2,9.6c0,2.9,2.3,5.2,5.2,5.2s5.2-2.3,5.2-5.2C17.2,12.2,13.8,7.3,12,4.8z"/><path d="M12,18.2c-0.4,0-0.7-0.3-0.7-0.7s0.3-0.7,0.7-0.7c1.3,0,2.4-1.1,2.4-2.4c0-0.4,0.3-0.7,0.7-0.7c0.4,0,0.7,0.3,0.7,0.7C15.8,16.5,14.1,18.2,12,18.2z"/>
				</symbol>
				<symbol id="icon-search" viewBox="0 0 24 24">
					<title>search</title>
					<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</symbol>
				<symbol id="icon-cross" viewBox="0 0 24 24">
					<title>cross</title>
					<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
				</symbol>
			</defs>
		</svg>

		
		
		<main class="main-wrap">
			<header class="codrops-header">
				<h1 class="codrops-header__title">STARKID</h1>
				<div class="search-wrap">
					<button id="btn-search" class="btn btn--search"><svg class="icon icon--search"><use xlink:href="#icon-search"></use></svg></button>
				</div>
			</header>

			<!-- <div class="loaderDiv" id="loader"> <span class="loader"></span> </div> -->
<!-- =================== -->
<div id="qrtroqcontainer" class=" container swiperSlide">


		<div class=" responsive-svg" id="canvas"></div>
		
	</div>
	<pre id="yourAddress"> </pre>
<!-- ======================= -->
			<!-- <div class=" responsive-svg" id="canvas"></div>
			<pre id="yourAddress"> </pre> -->

<div id="qrresult"> </div>


			<div class="bottom-nav">
				<nav class="codrops-demos">
					<span>v 0.1 </span>
					<!-- <a class="current-demo" href="index.html">Load</a>
					<a href="index.html">chat</a> -->
				</nav>
			</div>

<!-- FIN UI -->

</main>


<div class="search">
	<button id="btn-search-close" class="btn btn--search-close" aria-label="Close search form"><svg class="icon icon--cross"><use xlink:href="#icon-cross"></use></svg></button>
	<form class="search__form" action="">
		<input class="search__input" name="search" type="search" placeholder="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
		<span class="search__info">Hit enter to search or ESC to close</span>
	</form>
	<div class="search__related">
		<div class="search__suggestion">
			<h3>Contacts?</h3>
			<p>#drone #funny #catgif #broken #lost #hilarious #good #red #blue #nono #why #yes #yesyes #aliens #green</p>
		</div>
		<div class="search__suggestion">
			<h3>Unapproved contacts</h3>
			<p>#0x123456789123456789,#0x123456789123456788,#0x123456789123456787</p>
		</div>
		<div class="search__suggestion">
			<h3>Blocked</h3>
			<p>#0x123456789123456786,#0x123456789123456785,#0x123456789123456784</p>
		</div>
	</div>
</div><!-- /search -->
		<script type="module" src="js/demo1.js"></script>
		<script type="module">

import { Provider, Account, constants, ec, json, stark, Provider, hash, CallData } from 'starknet';

			window.Provider = Provider;
			window.Account = Account;
			window.constants = constants;
			window.ec = ec;
			window.json = json;
			window.stark = stark;
			window.Provider = Provider;
			window.hash = hash;
			window.CallData = CallData;
</script>

		<script>

    /*********************************************************************************************
		.) SOUNDS
		**********************************************************************************************/

		function playBeep() {
  var AudioContext = window.AudioContext || window.webkitAudioContext;
  var audioCtx = new AudioContext();

  var oscillator = audioCtx.createOscillator();
  oscillator.type = "sine"; // Set the waveform type
  oscillator.frequency.value = 864; // Set the frequency (Hz)

  oscillator.connect(audioCtx.destination);
  oscillator.start();

  // Stop the oscillator after 100 milliseconds
  setTimeout(function () {
    oscillator.stop();
  }, 100);
}


/*********************************************************************************************
.) sweetalert2
// position: "top-right",
**********************************************************************************************/

const ToastTop = Swal.mixin({
  toast: true,
  position: "bottom-end",
  showConfirmButton: false,
  timer: 3000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener("mouseenter", Swal.stopTimer);
    toast.addEventListener("mouseleave", Swal.resumeTimer);
  },
  iconColor: "white",
  customClass: {
    popup: "colored-toast",
  },
});


function copy2clipboard(text) {
			// let text = `${ipfsGateway}${cid}`;
			console.log('COPIED!', text)
			let textLink = `<a href="${text}">${text}</a>`;

			if (window.clipboardData && window.clipboardData.setData) {
				ToastTop.fire('Copied to Clipboard', textLink, "success");
				return window.clipboardData.setData("Text", text);
			}
			else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
				var textarea = document.createElement("textarea");
				textarea.textContent = text;
				textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in Microsoft Edge.
				document.body.appendChild(textarea);
				textarea.select();
				try {
					ToastTop.fire('Copied to Clipboard!', textLink, "success");
					return document.execCommand("copy");  // Security exception may be thrown by some browsers.
				}
				catch (ex) {
					console.warn("Copy to clipboard failed.", ex);
					return prompt("Copy to clipboard: Ctrl+C, Enter", text);
				}
				finally {
					document.body.removeChild(textarea);
				}
			}
		}


async function createAddress(){
            console.log('createAddress()')
            const provider = new Provider({ sequencer: { network: constants.NetworkName.SN_GOERLI } });
            let privateKey = localStorage.getItem('privKey');
            if (!privateKey) {
                privateKey = stark.randomAddress();
                console.log('New OZ account:\nprivateKey=', privateKey);
                // Store the new privateKey in localStorage
                localStorage.setItem('privKey', privateKey);
                console.log('privKey SAVED INTO LOCALSTORAGE');
            } else {
                console.log('privKey already exists in localStorage:', privateKey);
            }


            const starkKeyPub = ec.starkCurve.getStarkKey(privateKey);
            console.log('publicKey=', starkKeyPub);

            const OZaccountClassHash = '0x2794ce20e5f2ff0d40e632cb53845b9f4e526ebd8471983f7dbd355b721d5a';
            // Calculate future address of the account
            const OZaccountConstructorCallData = CallData.compile({ publicKey: starkKeyPub });
            const OZcontractAddress = hash.calculateContractAddressFromHash( starkKeyPub, OZaccountClassHash, OZaccountConstructorCallData, 0 );
            console.log('Precalculated account address=', OZcontractAddress);
            // qrresult.innerHTML = OZcontractAddress
            
			// 3- SHOW QR
			// canvas.innerHTML = '';
			showqr(OZcontractAddress);
			let shortAddr = OZcontractAddress.substring(0, 6) + "..." + OZcontractAddress.substring(38, 42);

			yourAddress.innerHTML += `${shortAddr} <svg id='copyAddress' onclick="event.stopPropagation();copy2clipboard('${OZcontractAddress}')" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"> <path  d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg>`;
			console.log(`Your address: ${OZcontractAddress} `)


            ////////
            // 2
            const OZaccount = new Account(provider, OZcontractAddress, privateKey);
            console.log('now PUBLISH',OZaccount)
return 

			console.log('DEPLOY ACCOUNT...')
			const { transaction_hash, contract_address } = await OZaccount.deployAccount({
			classHash: OZaccountClassHash,
			constructorCalldata: OZaccountConstructorCallData,
			addressSalt: starkKeyPub,
			});

			await provider.waitForTransaction(transaction_hash);
			console.log('✅ New OpenZeppelin account created.\n   address =', contract_address);



}


		/*********************************************************************************************
		.)  QR
		**********************************************************************************************/

		async function showqr(addr) {
			const qrColor = getComputedStyle(document.body).getPropertyValue('--qr');

			var isMobile = window.matchMedia("only screen and (max-width: 768px)");

			// let qrSize
			if (isMobile.matches) {
				console.log("Mobile screen detected");
				
				//get container width
				// var containerWidth = document.getElementById('qrtroqcontainer').offsetWidth;
				
				// // Code for mobile screens
				// qrSize = containerWidth - 50 ;
				// console.log("Mobile'scontainerWidth: ",containerWidth);
				qrSize = 310;
				window.scrollTo(0, 0);


			} else {
				// Code for larger screens
				console.log("Not a mobile screen");
				qrSize = 370

			}

			//QR
			const qrCode = new QRCodeStyling({
				width: `${qrSize}`, height: `${qrSize}`, type: "png", data: addr, image: `./logo4.png`,
				// dotsOptions: { color: "#1568B0", type: "extra-rounded" }, 
				dotsOptions: { color: `${qrColor}`, type: "extra-rounded" },
				backgroundOptions: { color: "var(--qrbackground)", },
				imageOptions: { crossOrigin: "anonymous", margin: 0 }
			});
			qrCode.append(document.getElementById("canvas"));
			console.log('qr code APPENDED')
			document.querySelector('.main-wrap').style.backgroundImage = 'none';
			loader.style.display= 'none'

		}


			async function init(){
				console.log('init()')
				
				createAddress()
				// displayQR('myDid') 
				// loader.style.display= 'flex'

				// setTimeout(() => {
				// 	loader.style.display= 'none'
				// }, 3000);
			
			}
			init()
			

 

// async function createAddress(){
//             console.log('createAddress()')
//             // connect provider
//             const provider = new Provider({ sequencer: { network: constants.NetworkName.SN_GOERLI } });

//             // new Open Zeppelin account v0.5.1
//             // Generate public and private key pair.
//             const privateKey = stark.randomAddress();
//             console.log('New OZ account:\nprivateKey=', privateKey);
//             const starkKeyPub = ec.starkCurve.getStarkKey(privateKey);
//             console.log('publicKey=', starkKeyPub);

//             const OZaccountClassHash = '0x2794ce20e5f2ff0d40e632cb53845b9f4e526ebd8471983f7dbd355b721d5a';
//             // Calculate future address of the account
//             const OZaccountConstructorCallData = CallData.compile({ publicKey: starkKeyPub });
//             const OZcontractAddress = hash.calculateContractAddressFromHash(
//             starkKeyPub,
//             OZaccountClassHash,
//             OZaccountConstructorCallData,
//             0
//             );
//             console.log('Precalculated account address=', OZcontractAddress);


// }


function displayQR(data) {
    console.log('displayQR(data)')
            const qrCode = new QRCodeStyling({
                width: 500, height: 500, type: "png", data: data, image: `id5.svg`,
                dotsOptions: { color: "#1568B0", type: "extra-rounded" },
                backgroundOptions: { color: "var(--qrbackground)", },
                imageOptions: { crossOrigin: "anonymous", margin: 3 }
            });
            qrCode.append(document.getElementById("canvas"));
            // canvas.classList.add('animate')




        }


			</script>
	</body>
</html>
