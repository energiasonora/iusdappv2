<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple DApp</title>
    <link rel="stylesheet" href="css/pico.min.css" />
    <script src="js/sweetalert2.all.min.js"></script>
    <script src="js/ethers-6.13.2.umd.min.js"></script>

 

    <style>
        /* Custom styles */
        .connect-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .wallet-info {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header>
        <button class="primary connect-btn" id="connectButton">Connect</button>
    </header>
    
    <main>
        <div class="container">
            <h1>Welcome to the DApp!</h1>
            <p>Click "Connect" to link your wallet.</p>
            <div class="wallet-info" id="walletInfo"></div>
        </div>
    </main>


    <!-- Button to Open Modal -->
  <button type="button" class="primary" data-bs-toggle="modal" data-bs-target="#walletModal">
    Select Wallet
  </button>

  <!-- Modal -->
  <dialog id="walletModal">
    <form method="dialog">
      <header>
        <h2>Select Your Wallet</h2>
      </header>
      <section>
        <p>Please choose a wallet to connect:</p>
        <button id="metamaskBtn" class="contrast w-100">MetaMask</button>
        <button id="iusNaturalisBtn" class="success w-100">Ius Naturalis Wallet</button>
      </section>
      <footer>
        <button type="reset" class="secondary" data-bs-dismiss="modal">Close</button>
      </footer>
    </form>
  </dialog>

  <!-- Scripts -->
  <script>
    // Open modal when clicking the button
    document.querySelector('button[data-bs-toggle="modal"]').addEventListener('click', function () {
      document.getElementById('walletModal').showModal();
    });

    // Close modal when clicking 'Close' button
    document.querySelector('button[data-bs-dismiss="modal"]').addEventListener('click', function () {
      document.getElementById('walletModal').close();
    });

    // MetaMask Button
    document.getElementById('metamaskBtn').addEventListener('click', async () => {
      if (typeof window.ethereum !== 'undefined') {
        try {
          // Request account access from MetaMask
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          console.log('Connected to MetaMask:', accounts[0]);
          alert('MetaMask connected: ' + accounts[0]);
          document.getElementById('walletModal').close(); // Close modal after selection
        } catch (error) {
          console.error('MetaMask connection error:', error);
          alert('Failed to connect to MetaMask. Please try again.');
        }
      } else {
        alert('MetaMask is not installed. Please install it and try again.');
      }
    });

    // Ius Naturalis Wallet Button
    document.getElementById('iusNaturalisBtn').addEventListener('click', () => {
      console.log('Ius Naturalis Wallet selected.');
      alert('Ius Naturalis Wallet is selected. Proceed with your integration.');
      displayUserInfo() 
      document.getElementById('walletModal').close(); // Close modal after selection
      // Add your wallet integration logic here.
    });
 



         // Display wallet address and logout option
         function displayUserInfo() {
            const walletInfoElement = document.getElementById("walletInfo");
            walletInfoElement.innerHTML = `
                <span>Connected as: ${userAddress}</span>
                <span class="logout-btn" id="logoutButton">Logout</span>
            `;
            
            // Logout functionality
            document.getElementById("logoutButton").addEventListener("click", logout);
        }





        // Initialize Ethers.js
        let provider;
        let signer;
        let userAddress = null;

        // Connect to the user's wallet
        async function connectWallet() {
            if (window.ethereum) {
                // Prompt user to connect their wallet
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                // Update UI with wallet address
                document.getElementById("walletInfo").innerHTML = `Connected as: ${userAddress}`;
                document.getElementById("connectButton").innerText = 'Disconnect';
            } else {
                alert("Please install MetaMask to use this DApp.");
            }
        }

        // Handle button click (connect/disconnect)
        document.getElementById("connectButton").addEventListener("click", () => {
            if (userAddress) {
                // Disconnect wallet
                userAddress = null;
                signer = null;
                provider = null;
                document.getElementById("walletInfo").innerHTML = '';
                document.getElementById("connectButton").innerText = 'Connect';
            } else {
                // Connect wallet
                connectWallet();
            }
        });
    </script>
</body>
</html>
