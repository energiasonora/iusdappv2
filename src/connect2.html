<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple DApp</title>
    <link rel="stylesheet" href="css/pico.min.css" />
    <script src="js/sweetalert2.all.min.js"></script>
    <script src="js/ethers-6.13.2.umd.min.js"></script>

    <style>
             body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Custom styles */
        .connect-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .wallet-info {
            margin-top: 20px;
            display: flex;
            align-items: center;
        }
        .wallet-info span {
            margin-right: 10px;
        }
        .logout-btn {
            cursor: pointer;
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <button class="primary connect-btn" id="connectButton">Connect</button>
    </header>
    
    <main>
        <div class="container">
            <h1>Welcome to the DApp!</h1>
            <p>Click "Connect" to link your wallet.</p>
            <div class="wallet-info" id="walletInfo"></div>
        </div>
    </main>

    <script>
        // Initialize Ethers.js
        let provider;
        let signer;
        let userAddress = null;

        // Check localStorage for saved wallet address and provider
        if (localStorage.getItem('userAddress') && localStorage.getItem('provider')) {
            userAddress = localStorage.getItem('userAddress');
            document.getElementById("connectButton").innerText = 'Disconnect';
            displayUserInfo();
        }

        // Connect to the user's wallet
        async function connectWallet() {
            if (window.ethereum) {
                // Save provider to localStorage
                localStorage.setItem('provider', 'MetaMask');
                
                // Prompt user to connect their wallet
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                // Save address to localStorage
                localStorage.setItem('userAddress', userAddress);

                // Update UI with wallet address
                displayUserInfo();
                document.getElementById("connectButton").innerText = 'Disconnect';
            } else {
                alert("Please install MetaMask to use this DApp.");
            }
        }

        // Display wallet address and logout option
        function displayUserInfo() {
            const walletInfoElement = document.getElementById("walletInfo");
            walletInfoElement.innerHTML = `
                <span>Connected as: ${userAddress}</span>
                <span class="logout-btn" id="logoutButton">Logout</span>
            `;
            
            // Logout functionality
            document.getElementById("logoutButton").addEventListener("click", logout);
        }

        // Handle button click (connect/disconnect)
        document.getElementById("connectButton").addEventListener("click", () => {
            if (userAddress) {
                logout();  // Logout if already connected
            } else {
                connectWallet();  // Connect wallet if not already connected
            }
        });

        // Logout functionality to clear localStorage and UI
        function logout() {
            localStorage.removeItem('userAddress');
            localStorage.removeItem('provider');
            userAddress = null;
            signer = null;
            provider = null;
            document.getElementById("walletInfo").innerHTML = '';
            document.getElementById("connectButton").innerText = 'Connect';
        }
    </script>
</body>
</html>
